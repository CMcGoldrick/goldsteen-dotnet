@model PotOfMcGold.Models.IndexClass.CryptoIndex

@{
    ViewBag.Title = "Index";
    int i = 0;
    int l = Model.Payload.Length;
    string selectedVar = "";
}

<table class="table table-dark">
    <thead>
        <tr>
            <th>Coin</th>
            <th>Price</th>
            <th>1 Hour</th>
            <th>24 Hour</th>
            <th>1 Week</th>
        </tr>
    </thead>
    <tbody>
        @for (i = 0; i < l; i++)
        {
            if (Model.Payload[i].CryptoType == true)
            {
                <tr>
                    <td class="list-name" onclick="makeCall('@Model.Payload[i].Id.ToString()')" data-toggle="modal" data-target=".modal" data-paragraphs="10">@Model.Payload[i].Name</td>
                    <td>$ @String.Format("{0:0.00000}", Model.Payload[i].Price)</td>
                    <td class="@(@Model.Payload[i].Change1Hour > 0 ? "green" : "red")">@String.Format("{0:0.##\\%}", Model.Payload[i].Change1Hour)</td>
                    <td class="@(@Model.Payload[i].Change > 0 ? "green" : "red")">@String.Format("{0:0.##\\%}", Model.Payload[i].Change)</td>
                    <td class="@(@Model.Payload[i].Change1Week > 0 ? "green" : "red")">@String.Format("{0:0.##\\%}", Model.Payload[i].Change1Week)</td>
                </tr>
            }
        }
    </tbody>
</table>

<div class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body" id="mod-content">
                <img src="~/Images/SVG/Spinner-1s-200px.svg" class="loading-svg"/>
            </div>
            <div class="modal-footer">
                <button onclick="clearData()" type="button" class="btn btn-default modal-btn" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
<script>
    function makeCall(id) {
        $.ajax({
            url: '/api/cryptodetails/' + id,
            type: 'GET',
            success: function (result) {
                var modal = $("#mod-content");
                modal.html(result);
            },
            error: function (error) {
                console.log(error);
            }
        });
    }

    function clearData() {
        var modal = $("#mod-content");
        modal.html("<img src='/Images/SVG/Spinner-1s-200px.svg' class='loading-svg'/>");
    }

    $(document).mouseup(function (e) {
        var container = $("#mod-content");
        if (!container.is(e.target) && container.has(e.target).length === 0) {
            container.html("<img src='/Images/SVG/Spinner-1s-200px.svg' class='loading-svg'/>");
        }
    });

</script>